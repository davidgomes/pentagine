function drawCircle(n,t,i,r){context.fillStyle=r,context.beginPath(),context.arc(n,t,i,0,Math.PI*2,!1),context.fill()}function drawRectangle(n,t,i,r,u){u&&(context.fillStyle=u),context.fillRect(n,t,i,r)}function drawLine(n,t,i,r,u){u&&(context.fillStyle=u),context.beginPath(),context.moveTo(n,t),context.lineTo(i,r),context.stroke()}function drawString(n,t,i,r,u){context.textAlign=u?u:"left",context.font=currentFont,context.fillStyle=r,context.fillText(n,t,i)}function clearCanvas(n){context.clearRect(0,0,context.width,context.height),n!=null&&drawRectangle(0,0,context.width,context.height,n)}function isOutsideOfScreen(n,t){return n<0||n>context.width||t<0||t>context.height}function preventKeys(n){preventedKeys=n}function handleKeyDown(n){var i=n?n:window.event,t=keyCodeToString[i.keyCode];pressedKeys[t]=!0,preventedKeys[t]&&n.preventDefault()}function handleKeyUp(n){var i=n?n:window.event,t=keyCodeToString[i.keyCode];pressedKeys[t]=!1,preventedKeys[t]&&n.preventDefault()}function isDown(n){return pressedKeys[n]?!0:!1}function handleMouseDown(n){var t=n?n:window.event,i=convertMouseButtonToString[t.button];pressedButtons[i]=!0}function handleMouseUp(n){var t=n?n:window.event,i=convertMouseButtonToString[t.button];pressedButtons[i]=!1}function handleMouseMove(n){n.offsetX?(mouseX=n.offsetX,mouseY=n.offsetY):n.layerX&&(mouseX=n.layerX,mouseY=n.layerY),typeof currentState!="undefined"&&(mouseX+=currentState.camera.x,mouseY+=currentState.camera.y)}function isMouseDown(n){return pressedButtons[n]?!0:!1}function handleTouchStart(n){var t=n?n:window.event;pressedButtons.left=!0,mouseX=n.touches[0].pageX-canvas.offsetLeft,mouseY=n.touches[0].pageY-canvas.offsetTop,typeof currentState!="undefined"&&(mouseX+=currentState.camera.x,mouseY+=currentState.camera.y)}function handleTouchEnd(n){var t=n?n:window.event;pressedButtons.left=!1}function handleTouchMove(n){var i=n?n:window.event,t;n.stopPropagation(),n.preventDefault(),t=document.createEvent("MouseEvent"),t.initMouseEvent("mousemove",!0,!0,window,n.detail,n.touches[0].screenX,n.touches[0].screenY,n.touches[0].clientX,n.touches[0].clientY,!1,!1,!1,!1,0,null),window.dispatchEvent(t)}function init(){if(lastUpdate=Date.now(),desiredFPS)var n=setInterval(tick,1e3/desiredFPS);else setInterval(tick,0)}function tick(){var n=Date.now(),t=n-lastUpdate;lastUpdate=n,currentState.dt=t*.001,stats.begin(),gamePaused?(currentState.draw(),isDown(pauseKey)&&pauseOrResumeGame()):(isDown(pauseKey)&&pauseOrResumeGame(),currentState.update(),currentState.draw()),stats.end()}function pauseOrResumeGame(){canPauseOrResume&&(gamePaused=!gamePaused,setTimeout(function(){canPauseOrResume=!0},1e3),canPauseOrResume=!1)}function switchState(n){return currentState||init(),n.camera||(n.camera=new Camera(0,0,context.width,context.height)),n.setup(),currentState=n}var keyCodeToString,i,pressedKeys,preventedKeys,Stats,canvas,context;Animation=function(){function n(){}return n.prototype={},n}(),SpriteList=function(){function n(){this.sprites=[]}return n.prototype={draw:function(){for(var n=0;n<this.sprites.length;n++)this.sprites[n]&&this.sprites[n].draw()},push:function(n){this.sprites.push(n)},remove:function(n){var t=this.sprites.indexOf(n);this.sprites.splice(t,1)},getLength:function(){return this.sprites.length}},n}(),Camera=function(){function n(n,t,i,r){this.x=n,this.y=t,this.width=i,this.height=r}return n.prototype={follow:function(){}},n}(),window.addEventListener("keydown",handleKeyDown),window.addEventListener("keyup",handleKeyUp),keyCodeToString=[],keyCodeToString[8]="backspace",keyCodeToString[9]="tab",keyCodeToString[13]="return",keyCodeToString[16]="shift",keyCodeToString[17]="ctrl",keyCodeToString[18]="alt",keyCodeToString[19]="pause",keyCodeToString[20]="capslock",keyCodeToString[27]="esc",keyCodeToString[32]="space",keyCodeToString[33]="pageup",keyCodeToString[34]="pagedown",keyCodeToString[35]="end",keyCodeToString[36]="home",keyCodeToString[37]="left",keyCodeToString[38]="up",keyCodeToString[39]="right",keyCodeToString[40]="down",keyCodeToString[45]="insert",keyCodeToString[46]="delete",keyCodeToString[91]="leftwindowkey",keyCodeToString[92]="rightwindowkey",keyCodeToString[93]="selectkey",keyCodeToString[106]="multiply",keyCodeToString[107]="add",keyCodeToString[109]="subtract",keyCodeToString[110]="decimalpoint",keyCodeToString[111]="divide",keyCodeToString[144]="numlock",keyCodeToString[145]="scrollock",keyCodeToString[186]="semicolon",keyCodeToString[187]="equalsign",keyCodeToString[188]="comma",keyCodeToString[189]="dash",keyCodeToString[190]="period",keyCodeToString[191]="forwardslash",keyCodeToString[192]="graveaccent",keyCodeToString[219]="openbracket",keyCodeToString[220]="backslash",keyCodeToString[221]="closebracket",keyCodeToString[222]="singlequote";var numpadKeys=["numpad1","numpad2","numpad3","numpad4","numpad5","numpad6","numpad7","numpad8","numpad9"],numbers=["0","1","2","3","4","5","6","7","8","9"],letters=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];for(i=0;numbers[i];i++)keyCodeToString[48+i]=numbers[i];for(i=0;letters[i];i++)keyCodeToString[65+i]=letters[i];for(i=0;numpadKeys[i];i++)keyCodeToString[96+i]=numpadKeys[i];pressedKeys=[],preventedKeys=[],window.addEventListener("mousedown",handleMouseDown,!1),window.addEventListener("mouseup",handleMouseUp,!1),window.addEventListener("mousemove",handleMouseMove);var pressedButtons=[],mouseX=null,mouseY=null,convertMouseButtonToString=[];convertMouseButtonToString[0]="left",convertMouseButtonToString[1]="center",convertMouseButtonToString[2]="right",window.addEventListener("touchstart",handleTouchStart,!1),window.addEventListener("touchend",handleTouchEnd,!1),Sprite=function(){function n(n,t,i){if(this.x=t,this.y=i,this.alpha=1,this.angle=0,this.path=n,this.offset={x:0,y:0},!n){this.shared=!0,this.loaded=!0,console.log("Attempted to load null image.");return}if(this.shared=!0,this.path in sharedCanvases){var r=sharedCanvases[this.path];this.internal=r[0],this.internalctx=r[1],this.loaded=r[2].loaded,this.loaded||(this.pending=[],r[3].push(this))}else this.image=new Image,this.image.src=n,this.image.owner=this,this.loaded=!1,this.pending=[],this.internal=document.createElement("canvas"),this.internalctx=this.internal.getContext("2d"),sharedCanvases[this.path]=[this.internal,this.internalctx,this,[]],this.image.onload=function(){var t,n;for(this.owner.internal.width=this.width.toString(),this.owner.internal.height=this.height.toString(),this.owner.internalctx.drawImage(this,0,0),delete this.owner.image,this.owner.loaded=!0,this.owner.dispatchPending(),t=sharedCanvases[this.owner.path][3],n=0;n<t.length;n++)t[n].loaded=!0,t[n].dispatchPending()}}return n.prototype={draw:function(){this.angle&&(context.save(),context.translate(this.x+this.offset.x-currentState.camera.x,this.y+this.offset.y-currentState.camera.y),context.rotate(this.angle*degToRad),context.translate(-(this.x+this.offset.x-currentState.camera.x),-(this.y+this.offset.y-currentState.camera.y))),this.alpha!=1&&(context.globalAlpha=this.alpha),context.drawImage(this.internal,this.x-currentState.camera.x,this.y-currentState.camera.y),this.alpha!=1&&(context.globalAlpha=1),this.angle&&context.restore()},makeGraphic:function(n,t,i){this.shared&&this.releaseShared();var r=n.toString(),u=t.toString();(r!=this.internal.width||u!=this.internal.height)&&(this.internal.width=r,this.internal.height=u),this.stampRect(0,0,n,t,i)},makeLabel:function(n,t,i,r){this.shared&&this.releaseShared(),this.internalctx.font=t+"px "+i;var u=this.internalctx.measureText(n);this.makeGraphic(u.width,t*2,"rgba(0, 0, 0, 0)"),this.stampText(0,0,n,t,i,r)},stampText:function(n,t,i,r,u,f){this.loaded?(this.shared&&this.releaseShared(),this.internalctx.font=r+"px "+u,this.internalctx.textAlign="left",this.internalctx.fillStyle=f,this.internalctx.fillText(i,n,t+r)):this.pending.push([this.stampText,n,t,i,u,r,f])},stampRect:function(n,t,i,r,u){this.loaded?(this.shared&&this.releaseShared(),this.internalctx.fillStyle=u,this.internalctx.fillRect(n,t,i,r)):this.pending.push([this.stampRect,n,t,i,r,u])},stampImage:function(n,t,i){if(this.loaded){this.shared&&this.releaseShared();var r=new Image;r.src=i,r.sprite=this,r.target={x:n,y:t},r.onload=function(){this.sprite.internalctx.drawImage(this,this.target.x,this.target.y)}}else this.pending.push([this.stampImage,n,t,i])},dispatchPending:function(){for(var t=this.pending,n=0;n<t.length;n++)t[n][0].apply(this,Array.prototype.slice.call(t[n],1));delete this.pending},releaseShared:function(){var n=document.createElement("canvas");this.internalctx=n.getContext("2d"),this.path&&(n.width=this.internal.width.toString(),n.height=this.internal.height.toString(),this.internalctx.drawImage(sharedCanvases[this.path][0],0,0)),this.internal=n,this.shared=!1}},n}(),Stats=function(){var c=Date.now(),l=c,s=0,a=Infinity,v=0,h=0,y=Infinity,p=0,w=0,b=0,u=document.createElement("div"),n,f,t,e,i,o,r,k;for(u.id="stats",u.addEventListener("mousedown",function(n){n.preventDefault(),k(++b%2)},!1),u.style.cssText="width:80px;opacity:0.9;cursor:pointer",n=document.createElement("div"),n.id="fps",n.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",u.appendChild(n),f=document.createElement("div"),f.id="fpsText",f.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",f.innerHTML="FPS",n.appendChild(f),t=document.createElement("div"),t.id="fpsGraph",t.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",n.appendChild(t);74>t.children.length;)e=document.createElement("span"),e.style.cssText="width:1px;height:30px;float:left;background-color:#113",t.appendChild(e);for(i=document.createElement("div"),i.id="ms",i.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",u.appendChild(i),o=document.createElement("div"),o.id="msText",o.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",o.innerHTML="MS",i.appendChild(o),r=document.createElement("div"),r.id="msGraph",r.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",i.appendChild(r);74>r.children.length;)e=document.createElement("span"),e.style.cssText="width:1px;height:30px;float:left;background-color:#131",r.appendChild(e);return k=function(t){b=t;switch(b){case 0:n.style.display="block",i.style.display="none";break;case 1:n.style.display="none",i.style.display="block"}},{REVISION:11,domElement:u,setMode:k,begin:function(){c=Date.now()},end:function(){var n=Date.now(),i;return s=n-c,a=Math.min(a,s),v=Math.max(v,s),o.textContent=s+" MS ("+a+"-"+v+")",i=Math.min(30,30-30*(s/200)),r.appendChild(r.firstChild).style.height=i+"px",w++,n>l+1e3&&(h=Math.round(1e3*w/(n-l)),y=Math.min(y,h),p=Math.max(p,h),f.textContent=h+" FPS ("+y+"-"+p+")",i=Math.min(30,30-30*(h/100)),t.appendChild(t.firstChild).style.height=i+"px",l=n,w=0),n},update:function(){c=this.end()}}},canvas=document.getElementById("canvas"),context=null,typeof canvas!="undefined"&&(context=canvas.getContext("2d"),context.width=canvas.width,context.height=canvas.height);var sharedCanvases={},currentState=null,lastUpdate=null,desiredFPS=null,currentFont="10px serif",pauseKey="p",canPauseOrResume=!0,gamePaused=!1,radToDeg=180/Math.PI,degToRad=Math.PI/180,stats=new Stats;stats.setMode(2),stats.domElement.style.position="absolute",stats.domElement.style.left="800px",stats.domElement.style.top="0px",document.body.appendChild(stats.domElement)
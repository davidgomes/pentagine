!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Pentagine=e():t.Pentagine=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}var s=i(1),r=n(s),o=i(3),a=n(o),h=i(4),d=n(h);t.exports.Game=r["default"],t.exports.Sprite=a["default"],t.exports.SpriteList=d["default"]},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(2),a=n(o),h=function(){function t(){var e=this;s(this,t),this.desiredFPS=null,this.desiredInterval=null,this.lastUpdate=null,this.currentState=null,this.pressedKeys=[],this.preventedKeys=[],this.degToRad=Math.PI/180,this.keyCodeToString=[],this.keyCodeToString[8]="backspace",this.keyCodeToString[9]="tab",this.keyCodeToString[13]="return",this.keyCodeToString[16]="shift",this.keyCodeToString[17]="ctrl",this.keyCodeToString[18]="alt",this.keyCodeToString[19]="pause",this.keyCodeToString[20]="capslock",this.keyCodeToString[27]="escape",this.keyCodeToString[32]="space",this.keyCodeToString[33]="pageup",this.keyCodeToString[34]="pagedown",this.keyCodeToString[35]="end",this.keyCodeToString[36]="home",this.keyCodeToString[37]="left",this.keyCodeToString[38]="up",this.keyCodeToString[39]="right",this.keyCodeToString[40]="down",this.keyCodeToString[45]="insert",this.keyCodeToString[46]="delete",this.keyCodeToString[91]="leftwindowkey",this.keyCodeToString[92]="rightwindowkey",this.keyCodeToString[93]="selectkey",this.keyCodeToString[106]="multiply",this.keyCodeToString[107]="add",this.keyCodeToString[109]="subtract",this.keyCodeToString[110]="decimalpoint",this.keyCodeToString[111]="divide",this.keyCodeToString[144]="numlock",this.keyCodeToString[145]="scrollock",this.keyCodeToString[186]="semicolon",this.keyCodeToString[187]="equalsign",this.keyCodeToString[188]="comma",this.keyCodeToString[189]="dash",this.keyCodeToString[190]="period",this.keyCodeToString[191]="forwardslash",this.keyCodeToString[192]="graveaccent",this.keyCodeToString[219]="openbracket",this.keyCodeToString[220]="backslash",this.keyCodeToString[221]="closebracket",this.keyCodeToString[222]="singlequote";var i=["numpad1","numpad2","numpad3","numpad4","numpad5","numpad6","numpad7","numpad8","numpad9"],n=["0","1","2","3","4","5","6","7","8","9"],r=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];_.each(n,function(t,i){return e.keyCodeToString[48+i]=t}),_.each(r,function(t,i){return e.keyCodeToString[65+i]=t}),_.each(i,function(t,i){return e.keyCodeToString[48+i]=t}),window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("keyup",this.handleKeyUp.bind(this)),window.addEventListener("mousedown",this.handleMouseDown.bind(this),!1),window.addEventListener("mouseup",this.handleMouseUp.bind(this),!1),window.addEventListener("mousemove",this.handleMouseMove.bind(this),!1),window.addEventListener("touchstart",this.handleTouchStart.bind(this),!1),window.addEventListener("touchmove",this.handleTouchMove.bind(this),!1),window.addEventListener("touchend",this.handleTouchEnd.bind(this),!1),this.pressedButtons=[],this.mouse={},this.convertMouseButtonToString=[],this.convertMouseButtonToString[0]="left",this.convertMouseButtonToString[1]="center",this.convertMouseButtonToString[2]="right",this.pauseKey="p",this.canPauseOrResume=!0,this.gamePaused=!1,this.currentFont="10px serif"}return r(t,[{key:"tick",value:function(){window.requestAnimationFrame(this.tick.bind(this));var t=Date.now(),e=t-this.lastUpdate;this.desiredFPS?e>this.desiredInterval&&(this.lastUpdate=t-e%this.desiredInterval,this.currentState.dt=.001*e,this.currentState.update(),this.currentState.draw()):(this.lastUpdate=t,this.currentState.dt=.001*e,this.currentState.update(),this.currentState.draw())}},{key:"init",value:function(){this.lastUpdate=Date.now(),this.desiredFPS&&(this.desiredInterval=1e3/this.desiredFPS);window.requestAnimationFrame(this.tick.bind(this))}},{key:"handleKeyDown",value:function(t){var e=t?t:window.event,i=this.keyCodeToString[e.keyCode];this.pressedKeys[i]=!0,this.preventedKeys.indexOf(i)>-1&&t.preventDefault()}},{key:"handleKeyUp",value:function(t){var e=t?t:window.event,i=this.keyCodeToString[e.keyCode];this.pressedKeys[i]=!1,this.preventedKeys.indexOf(i)>-1&&t.preventDefault()}},{key:"handleTouchStart",value:function(t){var e=t?t:window.event;mouse.x=e.targetTouches[0].pageX,mouse.y=e.targetTouches[0].pageY,this.pressedButtons.left=!0}},{key:"handleTouchEnd",value:function(t){t?t:window.event;this.pressedButtons.left=!1}},{key:"handleMouseDown",value:function(t){var e=t?t:window.event,i=this.convertMouseButtonToString[e.button];this.pressedButtons[i]=!0}},{key:"handleMouseUp",value:function(t){var e=t?t:window.event,i=this.convertMouseButtonToString[e.button];this.pressedButtons[i]=!1}},{key:"handleMouseMove",value:function(t){t.offsetX?(this.mouse.x=t.offsetX,this.mouse.y=t.offsetY):t.layerX&&(this.mouse.x=t.layerX,this.mouse.y=t.layerY),null!==this.currentState&&(this.mouse.x+=this.currentState.camera.x,this.mouse.y+=this.currentState.camera.y)}},{key:"handleTouchMove",value:function(t){t?t:window.event;t.stopPropagation(),t.preventDefault();var e=document.createEvent("MouseEvent");e.initMouseEvent("mousemove",!0,!0,window,t.detail,t.touches[0].screenX,t.touches[0].screenY,t.touches[0].clientX,t.touches[0].clientY,!1,!1,!1,!1,0,null),window.dispatchEvent(e)}}]),r(t,[{key:"setup",value:function(t){return this.canvas=document.getElementById("canvas"),t.desiredFPS&&(this.desiredFPS=t.desiredFPS),t.preventedKeys&&(this.preventedKeys=t.preventedKeys),"undefined"!=typeof this.canvas&&(this.canvas.width=t.width,this.canvas.height=t.height,this.context=this.canvas.getContext("2d"),this.context.width=t.width,this.context.height=t.height),this.switchState(t.firstState),this}},{key:"drawCircle",value:function(t,e,i,n){this.context.fillStyle=n,this.context.beginPath(),this.context.arc(t,e,i,0,2*Math.PI,!1),this.context.fill()}},{key:"drawRectangle",value:function(t,e,i,n,s){s&&(this.context.fillStyle=s),this.context.fillRect(t,e,i,n)}},{key:"drawLine",value:function(t,e,i,n,s){s&&(this.context.strokeStyle=s),this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,n),this.context.stroke()}},{key:"drawString",value:function(t,e,i,n,s){s?this.context.textAlign=s:this.context.textAlign="left",this.context.textBaseline="top",this.context.font=this.currentFont,this.context.fillStyle=n,this.context.fillText(t,e,i)}},{key:"clearCanvas",value:function(t){this.context.clearRect(0,0,this.context.width,this.context.height),t&&this.drawRectangle(0,0,this.context.width,this.context.height,t)}},{key:"isOutsideOfScreen",value:function(t,e){return 0>t||t>this.context.width||0>e||e>this.context.height}},{key:"getpressedKeys",value:function(){return this.pressedKeys}},{key:"getPressedButtons",value:function(){return this.pressedButtons}},{key:"isDown",value:function(t){return!!this.pressedKeys[t]}},{key:"isMouseDown",value:function(t){return!!this.pressedButtons[t]}},{key:"switchState",value:function(t){return this.currentState||(this.currentState=t,this.init()),t.camera||(t.camera=new a["default"](0,0,this.context.width,this.context.height)),t.setup(),this.currentState=t,this.currentState}}]),t}();t.exports=h},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(){function t(e,n,s,r){i(this,t),this.x=e,this.y=n,this.width=s,this.height=r}return n(t,[{key:"follow",value:function(){}}]),t}();t.exports=s},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(){function t(e,n,s,r){if(i(this,t),this.x=s,this.y=r,this.alpha=1,this.angle=0,this.path=n,this.currentState=e.currentState,this.offset={x:0,y:0},this.context=e.context,this.sharedCanvases={},!n)return this.shared=!0,this.loaded=!0,void console.log("Error: Attempted to load null image.");if(this.shared=!0,this.path in this.sharedCanvases){var o=this.sharedCanvases[this.path];this.internal=o[0],this.internalctx=o[1],this.loaded=o[2].loaded,this.loaded||(this.pending=[],o[3].push(this))}else{this.image=new Image,this.image.src=n,this.image.owner=this,this.loaded=!1,this.pending=[],this.internal=document.createElement("canvas"),this.internalctx=this.internal.getContext("2d"),this.sharedCanvases[this.path]=[this.internal,this.internalctx,this,[]];var a=this.sharedCanvases;this.image.onload=function(){this.owner.internal.width=this.width.toString(),this.owner.internal.height=this.height.toString(),this.owner.internalctx.drawImage(this,0,0),delete this.owner.image,this.owner.loaded=!0,this.owner.dispatchPending();for(var t=a[this.owner.path][3],e=0;e<t.length;e++)t[e].loaded=!0,t[e].dispatchPending()}}}return n(t,[{key:"draw",value:function(){this.angle&&(this.context.save(),this.context.translate(this.x+this.offset.x-this.currentState.camera.x,this.y+this.offset.y-this.currentState.camera.y),this.context.rotate(this.angle*degToRad),this.context.translate(-(this.x+this.offset.x-this.currentState.camera.x),-(this.y+this.offset.y-this.currentState.camera.y))),1!=this.alpha&&(this.context.globalAlpha=this.alpha),this.context.drawImage(this.internal,this.x-this.currentState.camera.x,this.y-this.currentState.camera.y),1!=this.alpha&&(this.context.globalAlpha=1),this.angle&&this.context.restore()}},{key:"makeGraphic",value:function(t,e,i){this.shared&&this.releaseShared();var n=t.toString(),s=e.toString();n==this.internal.width&&s==this.internal.height||(this.internal.width=n,this.internal.height=s),this.stampRect(0,0,t,e,i)}},{key:"makeLabel",value:function(t,e,i,n){this.shared&&this.releaseShared(),this.internalctx.font=e+"px "+i;var s=this.internalctx.measureText(t);this.makeGraphic(s.width,2*e,"rgba(0, 0, 0, 0)"),this.stampText(0,0,t,e,i,n)}},{key:"stampText",value:function(t,e,i,n,s,r){this.loaded?(this.shared&&this.releaseShared(),this.internalctx.font=n+"px "+s,this.internalctx.textAlign="left",this.internalctx.fillStyle=r,this.internalctx.fillText(i,t,e+n)):this.pending.push([this.stampText,t,e,i,s,n,r])}},{key:"stampRect",value:function(t,e,i,n,s){this.loaded?(this.shared&&this.releaseShared(),this.internalctx.fillStyle=s,this.internalctx.fillRect(t,e,i,n)):this.pending.push([this.stampRect,t,e,i,n,s])}},{key:"stampImage",value:function(t,e,i){var n=this;if(this.loaded){this.shared&&this.releaseShared();var s=new Image;s.src=i,s.sprite=this,s.target={x:t,y:e},s.onload=function(){n.sprite.internalctx.drawImage(n,n.target.x,n.target.y)}}else this.pending.push([this.stampImage,t,e,i])}},{key:"dispatchPending",value:function(){for(var t=this.pending,e=0;e<t.length;e++)t[e][0].apply(this,Array.prototype.slice.call(t[e],1));delete this.pending}},{key:"releaseShared",value:function(){var t=document.createElement("canvas");this.internalctx=t.getContext("2d"),this.path&&(t.width=this.internal.width.toString(),t.height=this.internal.height.toString(),this.internalctx.drawImage(sharedCanvases[this.path][0],0,0)),this.internal=t,this.shared=!1}}]),t}();t.exports=s},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(){function t(){i(this,t),this.sprites=[]}return n(t,[{key:"draw",value:function(){for(var t=0;t<this.sprites.length;t++)this.sprites[t]&&this.sprites[t].draw()}},{key:"push",value:function(t){this.sprites.push(t)}},{key:"remove",value:function(t){var e=this.sprites.indexOf(t);this.sprites.splice(e,1)}},{key:"getLength",value:function(){return this.sprites.length}}]),t}();t.exports=s}])});
var Pentagine=function(){function x(){var b=Date.now(),c=b-k;k=b;g.dt=0.001*c;g.update();g.draw()}function p(b){l[q[(b?b:window.event).button]]=!0}function r(b){l[q[(b?b:window.event).button]]=!1}function s(b){}function t(){}window.addEventListener("keydown",function(b){var c=a[(b?b:window.event).keyCode];m[c]=!0;n[c]&&b.preventDefault()});window.addEventListener("keyup",function(b){var c=a[(b?b:window.event).keyCode];m[c]=!1;n[c]&&b.preventDefault()});var a=[];a[8]="backspace";a[9]="tab";a[13]="return";
a[16]="shift";a[17]="ctrl";a[18]="alt";a[19]="pause";a[20]="capslock";a[27]="escape";a[32]="space";a[33]="pageup";a[34]="pagedown";a[35]="end";a[36]="home";a[37]="left";a[38]="up";a[39]="right";a[40]="down";a[45]="insert";a[46]="delete";a[91]="leftwindowkey";a[92]="rightwindowkey";a[93]="selectkey";a[106]="multiply";a[107]="add";a[109]="subtract";a[110]="decimalpoint";a[111]="divide";a[144]="numlock";a[145]="scrollock";a[186]="semicolon";a[187]="equalsign";a[188]="comma";a[189]="dash";a[190]="period";
a[191]="forwardslash";a[192]="graveaccent";a[219]="openbracket";a[220]="backslash";a[221]="closebracket";a[222]="singlequote";for(var u="numpad1 numpad2 numpad3 numpad4 numpad5 numpad6 numpad7 numpad8 numpad9".split(" "),v="0123456789".split(""),w="abcdefghijklmnopqrstuvwxyz".split(""),d=0;v[d];d++)a[48+d]=v[d];for(d=0;w[d];d++)a[65+d]=w[d];for(d=0;u[d];d++)a[96+d]=u[d];var m=[],n=[];window.addEventListener("mousedown",p,!1);window.addEventListener("mouseup",r,!1);window.addEventListener("mousemove",
s,!1);window.addEventListener("touchstart",p,!1);window.addEventListener("touchmove",r,!1);var l=[],q=["left","center","right"];window.addEventListener("touchend",s,!1);var h={},g=null,k=null;t.prototype={setup:function(){this.canvas=document.getElementById("canvas");this.context=null;"undefined"!==typeof this.canvas&&(this.context=this.canvas.getContext("2d"),this.context.width=this.canvas.width,this.context.height=this.canvas.height);return this},drawCircle:function(b,c,a,f){this.context.fillStyle=
f;this.context.beginPath();this.context.arc(b,c,a,0,2*Math.PI,!1);this.context.fill()},drawRectangle:function(b,c,a,f,e){e&&(this.context.fillStyle=e);this.context.fillRect(b,c,a,f)},drawLine:function(b,c,a,f,e){e&&(this.context.fillStyle=e);this.context.beginPath();this.context.moveTo(b,c);this.context.lineTo(a,f);this.context.stroke()},drawString:function(a,c,y,f,e){this.context.textAlign=e?e:"left";this.context.font="10px serif";this.context.fillStyle=f;this.context.fillText(a,c,y)},clearCanvas:function(a){this.context.clearRect(0,
0,this.context.width,this.context.height);null!=a&&this.drawRectangle(0,0,this.context.width,this.context.height,a)},isOutsideOfScreen:function(a,c){return 0>a||a>this.context.width||0>c||c>this.context.height},SpriteList:function(){function a(){this.sprites=[]}a.prototype={draw:function(){for(var c=0;c<this.sprites.length;c++)this.sprites[c]&&this.sprites[c].draw()},push:function(c){this.sprites.push(c)},remove:function(c){c=this.sprites.indexOf(c);this.sprites.splice(c,1)},getLength:function(){return this.sprites.length}};
return a}(),Camera:function(){function a(c,b,f,e){this.x=c;this.y=b;this.width=f;this.height=e}a.prototype={follow:function(){}};return a}(),preventKeys:function(a){n=a},isDown:function(a){return m[a]?!0:!1},isMouseDown:function(a){return l[a]?!0:!1},Sprite:function(){function a(c,b,f){this.x=b;this.y=f;this.alpha=1;this.angle=0;this.path=c;this.offset={x:0,y:0};this.context=penta.context;c?(this.shared=!0,this.path in h?(c=h[this.path],this.internal=c[0],this.internalctx=c[1],this.loaded=c[2].loaded,
this.loaded||(this.pending=[],c[3].push(this))):(this.image=new Image,this.image.src=c,this.image.owner=this,this.loaded=!1,this.pending=[],this.internal=document.createElement("canvas"),this.internalctx=this.internal.getContext("2d"),h[this.path]=[this.internal,this.internalctx,this,[]],this.image.onload=function(){this.owner.internal.width=this.width.toString();this.owner.internal.height=this.height.toString();this.owner.internalctx.drawImage(this,0,0);delete this.owner.image;this.owner.loaded=
!0;this.owner.dispatchPending();for(var a=h[this.owner.path][3],c=0;c<a.length;c++)a[c].loaded=!0,a[c].dispatchPending()})):(this.loaded=this.shared=!0,console.log("Attempted to load null image."))}a.prototype={draw:function(){this.angle&&(this.context.save(),this.context.rotate(this.angle*degToRad));1!=this.alpha&&(this.context.globalAlpha=this.alpha);this.context.drawImage(this.internal,this.x-g.camera.x,this.y-g.camera.y);1!=this.alpha&&(this.context.globalAlpha=1);this.angle&&this.context.restore()},
makeGraphic:function(a,b,f){this.shared&&this.releaseShared();var e=a.toString(),d=b.toString();if(e!=this.internal.width||d!=this.internal.height)this.internal.width=e,this.internal.height=d;this.stampRect(0,0,a,b,f)},makeLabel:function(a,b,f,e){this.shared&&this.releaseShared();this.internalctx.font=b+"px "+f;var d=this.internalctx.measureText(a);this.makeGraphic(d.width,2*b,"rgba(0, 0, 0, 0)");this.stampText(0,0,a,b,f,e)},stampText:function(a,b,f,e,d,g){this.loaded?(this.shared&&this.releaseShared(),
this.internalctx.font=e+"px "+d,this.internalctx.textAlign="left",this.internalctx.fillStyle=g,this.internalctx.fillText(f,a,b+e)):this.pending.push([this.stampText,a,b,f,d,e,g])},stampRect:function(a,b,f,e,d){this.loaded?(this.shared&&this.releaseShared(),this.internalctx.fillStyle=d,this.internalctx.fillRect(a,b,f,e)):this.pending.push([this.stampRect,a,b,f,e,d])},stampImage:function(a,b,d){if(this.loaded){this.shared&&this.releaseShared();var e=new Image;e.src=d;e.sprite=this;e.target={x:a,y:b};
e.onload=function(){this.sprite.internalctx.drawImage(this,this.target.x,this.target.y)}}else this.pending.push([this.stampImage,a,b,d])},dispatchPending:function(){for(var a=this.pending,b=0;b<a.length;b++)a[b][0].apply(this,Array.prototype.slice.call(a[b],1));delete this.pending},releaseShared:function(){var a=document.createElement("canvas");this.internalctx=a.getContext("2d");this.path&&(a.width=this.internal.width.toString(),a.height=this.internal.height.toString(),this.internalctx.drawImage(h[this.path][0],
0,0));this.internal=a;this.shared=!1}};return a}(),switchState:function(a){g||(g=a,k=Date.now(),setInterval(x,0));a.camera||(a.camera=new this.Camera(0,0,this.context.width,this.context.height));a.setup();return g=a}};return t}(),penta=(new Pentagine).setup();
